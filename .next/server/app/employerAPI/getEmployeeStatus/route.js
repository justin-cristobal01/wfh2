(()=>{var e={};e.id=953,e.ids=[953],e.modules={96330:e=>{"use strict";e.exports=require("@prisma/client")},10846:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},44870:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},3295:e=>{"use strict";e.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},29294:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},63033:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},12945:(e,t,r)=>{"use strict";r.r(t),r.d(t,{patchFetch:()=>D,routeModule:()=>v,serverHooks:()=>x,workAsyncStorage:()=>w,workUnitAsyncStorage:()=>f});var a={};r.r(a),r.d(a,{GET:()=>y,PUT:()=>m});var s=r(42706),n=r(28203),o=r(45994),i=r(39187),u=r(96330),l=r(86821),p=r(79174),c=r(87046);let d=new u.PrismaClient;async function y(){try{let e=await d.leave.findMany({where:{status:"APPROVED"},select:{startDate:!0,employeeId:!0,endDate:!0}}),t=await d.humanActivityLog.findMany({where:{end:null},select:{activity:!0,employeeId:!0}}),r=await d.employeeDetails.findMany({where:{activityStatus:null},select:{employeeId:!0}});for(let t of e)(0,l.c)(new Date(t.startDate))&&await d.employeeDetails.updateMany({where:{employeeId:t.employeeId,activityStatus:{not:"On Leave"}},data:{activityStatus:"On Leave",updatedAt:new Date}});for(let t of e){let e=function(e,t,r){let a=(0,c.a)(e,void 0);return isNaN(1)?(0,p.w)(e,NaN):(a.setDate(a.getDate()+1),a)}(new Date(t.endDate),1);(0,l.c)(e)&&await d.employeeDetails.updateMany({where:{employeeId:t.employeeId,activityStatus:"On Leave"},data:{activityStatus:"Active",updatedAt:new Date}})}for(let e of t)await d.employeeDetails.updateMany({where:{employeeId:e.employeeId},data:{activityStatus:e.activity}});for(let e of r)await d.employeeDetails.updateMany({where:{employeeId:e.employeeId},data:{activityStatus:"Active"}});return i.NextResponse.json({message:"Leave status updated successfully",checkLatestActivity:t,checkNull:r},{status:200})}catch(e){return console.error("Error updating leave status:",e),i.NextResponse.json({error:"Internal Server Error",details:e.message,stack:e.stack},{status:500})}finally{await d.$disconnect()}}async function m(e){try{let{searchParams:t}=new URL(e.url),r=t.get("employeeId");if(!r)return i.NextResponse.json({error:"Employee ID is required"},{status:400});if(!await d.employeeDetails.findUnique({where:{employeeId:r}}))return i.NextResponse.json({error:"Employee not found"},{status:404});return await d.employeeDetails.update({where:{employeeId:r},data:{activityStatus:"Active"}}),i.NextResponse.json({message:"Employee status updated to Active"},{status:200})}catch(e){return console.error("Error updating employee status:",e),i.NextResponse.json({error:"Internal Server Error",details:e.message,stack:e.stack},{status:500})}finally{await d.$disconnect()}}let v=new s.AppRouteRouteModule({definition:{kind:n.RouteKind.APP_ROUTE,page:"/employerAPI/getEmployeeStatus/route",pathname:"/employerAPI/getEmployeeStatus",filename:"route",bundlePath:"app/employerAPI/getEmployeeStatus/route"},resolvedPagePath:"C:\\Users\\justin\\Desktop\\vercel\\WFH-Monitoring\\src\\app\\employerAPI\\getEmployeeStatus\\route.tsx",nextConfigOutput:"",userland:a}),{workAsyncStorage:w,workUnitAsyncStorage:f,serverHooks:x}=v;function D(){return(0,o.patchFetch)({workAsyncStorage:w,workUnitAsyncStorage:f})}},18868:()=>{},78335:()=>{},61614:(e,t,r)=>{"use strict";r.d(t,{x:()=>s});var a=r(79174);function s(e,...t){let r=a.w.bind(null,e||t.find(e=>"object"==typeof e));return t.map(r)}},91462:(e,t,r)=>{"use strict";r.d(t,{_P:()=>n,my:()=>a,w4:()=>s});let a=6048e5,s=864e5,n=Symbol.for("constructDateFrom")},79174:(e,t,r)=>{"use strict";r.d(t,{w:()=>s});var a=r(91462);function s(e,t){return"function"==typeof e?e(t):e&&"object"==typeof e&&a._P in e?e[a._P](t):e instanceof Date?new e.constructor(t):new Date(t)}},86821:(e,t,r)=>{"use strict";r.d(t,{c:()=>o});var a=r(79174),s=r(61614),n=r(18614);function o(e,t){var r;return function(e,t,r){let[a,o]=(0,s.x)(void 0,e,t);return+(0,n.o)(a)==+(0,n.o)(o)}((0,a.w)(t?.in||e,e),(r=t?.in||e,(0,a.w)(r,Date.now())))}},18614:(e,t,r)=>{"use strict";r.d(t,{o:()=>s});var a=r(87046);function s(e,t){let r=(0,a.a)(e,t?.in);return r.setHours(0,0,0,0),r}},87046:(e,t,r)=>{"use strict";r.d(t,{a:()=>s});var a=r(79174);function s(e,t){return(0,a.w)(t||e,e)}}};var t=require("../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),a=t.X(0,[638,5452],()=>r(12945));module.exports=a})();
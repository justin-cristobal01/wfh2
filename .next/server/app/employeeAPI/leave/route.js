(()=>{var e={};e.id=8559,e.ids=[8559],e.modules={96330:e=>{"use strict";e.exports=require("@prisma/client")},10846:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},44870:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},3295:e=>{"use strict";e.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},29294:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},63033:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},50471:(e,t,r)=>{"use strict";r.r(t),r.d(t,{patchFetch:()=>D,routeModule:()=>v,serverHooks:()=>x,workAsyncStorage:()=>g,workUnitAsyncStorage:()=>w});var s={};r.r(s),r.d(s,{DELETE:()=>p,GET:()=>l,PATCH:()=>c,POST:()=>d});var a=r(42706),n=r(28203),o=r(45994),u=r(39187),i=r(84908);async function l(e){try{let{searchParams:t}=new URL(e.url),r=t.get("employeeId"),s=t.get("leaveType"),a=t.get("status"),n=t.get("startDate"),o=t.get("endDate"),l=parseInt(t.get("page")||"1",10),d=parseInt(t.get("pageSize")||"10",10),p=(l-1)*d;if(!r)return u.NextResponse.json({error:"User ID is required"},{status:400});let c={employeeId:r,...s&&{leaveType:s},...a&&{status:a},...n&&o&&{AND:[{startDate:{gte:new Date(n)}},{endDate:{lte:new Date(o)}}]}},[v,g]=await i.A.$transaction([i.A.leave.findMany({where:c,orderBy:{createdAt:"desc"},skip:p,take:d}),i.A.leave.count({where:c})]),w=Math.ceil(g/d);return u.NextResponse.json({leaves:v,totalPages:w,totalLeaves:g,currentPage:l,pageSize:d},{status:200})}catch(e){return console.error("Error fetching leaves:",e,e),u.NextResponse.json({error:"Internal Server Error",details:e},{status:500})}}async function d(e){try{let{employeeId:t,leaveType:r,startDate:s,endDate:a,reason:n}=await e.json();if(!t||!r||!s||!a||!n)return u.NextResponse.json({error:"All fields are required"},{status:400});if((await i.A.leave.findMany({where:{employeeId:t,status:{not:"REJECTED"},AND:[{startDate:{lte:new Date(a)}},{endDate:{gte:new Date(s)}}]}})).length>0)return u.NextResponse.json({error:"You already have a leave request within the specified date range"},{status:400});let o=await i.A.leave.create({data:{employeeId:t,leaveType:r,startDate:new Date(s),endDate:new Date(a),reason:n,status:"PENDING"}});return u.NextResponse.json({message:"Leave request submitted",leave:o},{status:201})}catch(e){return console.error("Error creating leave request:",e.message,e),u.NextResponse.json({error:"Internal Server Error",details:e.message},{status:500})}}async function p(e){try{let{id:t}=await e.json();if(!t)return u.NextResponse.json({error:"Leave ID is required"},{status:400});if(!await i.A.leave.findUnique({where:{id:t}}))return u.NextResponse.json({error:"Leave not found"},{status:404});return await i.A.leave.delete({where:{id:t}}),u.NextResponse.json({message:"Leave request deleted successfully"},{status:200})}catch(e){return console.error("Error deleting leave request:",e.message,e),u.NextResponse.json({error:"Internal Server Error",details:e.message},{status:500})}}async function c(e){try{let{id:t,leaveType:r,startDate:s,endDate:a,reason:n,status:o}=await e.json();if(!t)return u.NextResponse.json({error:"Leave ID is required"},{status:400});let l=await i.A.leave.findUnique({where:{id:t}});if(!l)return u.NextResponse.json({error:"Leave not found"},{status:404});if((await i.A.leave.findMany({where:{employeeId:l.employeeId,status:{not:"REJECTED"},AND:[{startDate:{lte:new Date(a)}},{endDate:{gte:new Date(s)}}],NOT:{id:t}}})).length>0)return u.NextResponse.json({error:"You already have a leave request within the specified date range"},{status:400});let d=await i.A.leave.update({where:{id:t},data:{leaveType:r||l.leaveType,startDate:s?new Date(s):l.startDate,endDate:a?new Date(a):l.endDate,reason:n||l.reason,status:o??l.status}});return u.NextResponse.json({message:"Leave request updated successfully",leave:d},{status:200})}catch(e){return console.error("Error updating leave request:",e.message,e),u.NextResponse.json({error:"Internal Server Error",details:e.message},{status:500})}}let v=new a.AppRouteRouteModule({definition:{kind:n.RouteKind.APP_ROUTE,page:"/employeeAPI/leave/route",pathname:"/employeeAPI/leave",filename:"route",bundlePath:"app/employeeAPI/leave/route"},resolvedPagePath:"C:\\Users\\justin\\Desktop\\vercel\\WFH-Monitoring\\src\\app\\employeeAPI\\leave\\route.tsx",nextConfigOutput:"",userland:s}),{workAsyncStorage:g,workUnitAsyncStorage:w,serverHooks:x}=v;function D(){return(0,o.patchFetch)({workAsyncStorage:g,workUnitAsyncStorage:w})}},18868:()=>{},78335:()=>{},84908:(e,t,r)=>{"use strict";r.d(t,{A:()=>a});var s=r(96330);let a=global.prisma??new s.PrismaClient}};var t=require("../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),s=t.X(0,[638,5452],()=>r(50471));module.exports=s})();
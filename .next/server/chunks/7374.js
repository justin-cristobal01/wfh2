"use strict";exports.id=7374,exports.ids=[7374],exports.modules={25527:(e,t,s)=>{s.r(t),s.d(t,{default:()=>g});var a=s(45512),r=s(28531),l=s.n(r),o=s(58009),i=s(79334),n=s(51255),c=s(48320);let d=(0,s(94825).A)("ChevronDown",[["path",{d:"m6 9 6 6 6-6",key:"qrunsl"}]]);var m=s(35120),x=s(25637),h=s(22792),u=s(19150),p=s(45103);let g=()=>{let[e,t]=(0,o.useState)(!1),[s,r]=(0,o.useState)(!1),[g,y]=(0,o.useState)(!1),[b,v]=(0,o.useState)(""),[f,j]=(0,o.useState)(""),[w,N]=(0,o.useState)(!1),[k,T]=(0,o.useState)(!1),S=(0,i.useRouter)(),I=(0,i.usePathname)(),[O,D]=(0,o.useState)(null),C=(0,o.useContext)(h.p),[A,E]=(0,o.useState)("Time In"),[$,P]=(0,o.useState)(!1),[L,R]=(0,o.useState)(!1),[J,F]=(0,o.useState)(!1),M={"/dashboard":"Dashboard","/activityMonitoring":"Activity Monitoring","/dtr":"Daily Time Record","/leaves":"Leaves","/dtr-problem":"Daily Time Record Problem","/overtime":"Overtime"};(0,o.useEffect)(()=>{let e=localStorage.getItem("user");e&&D(JSON.parse(e)),(async()=>{try{if(!e){console.error("User not found in localStorage.");return}let t=JSON.parse(e).employeeId,s=await fetch(`/employeeAPI/dtr?employeeId=${t}`);if(!s.ok)throw Error(`Server error: ${s.status} ${s.statusText}`);let a=await s.json();console.log("Fetched last DTR:",a),a&&null===a.timeOut?(E("Time Out"),R(!0)):(E("Time In"),R(!1))}catch(e){console.error("Error fetching last DTR:",e)}})()},[]),(0,o.useEffect)(()=>{let e=localStorage.getItem("user"),t=async()=>{if("Time Out"===A&&e){let t=JSON.parse(e).employeeId,s=new Date;await fetch("/employeeAPI/dtr",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({employeeId:t,timeOut:s,remarks:"Auto clock-out due to page close"})})}};return window.addEventListener("beforeunload",t),()=>{window.removeEventListener("beforeunload",t)}},[A]);let z=async()=>{try{let e;let t=localStorage.getItem("user");if(!t){S.push("/");return}let s=JSON.parse(t).employeeId,a=new Date;if(console.log(s+"employee ID hereeeeee"),"Time In"===A){if(C)await C.startCamera(),R(!0),e={employeeId:s,timeIn:a,timeOut:null,remarks:""};else{console.log("Camera permission not granted or camera context unavailable.");return}}else"Time Out"===A&&(C&&(await C.stopCamera(),F(!1),R(!1)),e={employeeId:s,timeOut:a,remarks:"Clocked out"});(await fetch("/employeeAPI/dtr",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)})).ok?E("Time In"===A?"Time Out":"Time In"):console.error("Failed to log action")}catch(e){console.error("Error logging action:",e)}},G=async()=>{let e=localStorage.getItem("user");if(r(!1),y(!0),"Time Out"===A&&e){let t=JSON.parse(e).employeeId,s=new Date;await fetch("/employeeAPI/dtr",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({employeeId:t,timeOut:s,remarks:"Auto clock-out due to logout"})}),E("Time In")}setTimeout(()=>{y(!1),localStorage.removeItem("authToken"),localStorage.removeItem("user"),C&&C.stopCamera(),S.push("/")},2e3)};(0,o.useEffect)(()=>{let e=setInterval(()=>{v(new Date().toLocaleTimeString("en-US",{hour12:!1}))},1e3);return()=>clearInterval(e)},[]),(0,o.useEffect)(()=>{let e=new Date,t=Intl.DateTimeFormat().resolvedOptions().timeZone,s=-e.getTimezoneOffset()/60;j(`GMT ${s>=0?"+":""}${s}:00 ${t}`)},[]),(0,o.useEffect)(()=>{let e=e=>{e.target.closest(".dropdown-container")||(N(!1),T(!1),P(!1))};return document.addEventListener("mousedown",e),()=>document.removeEventListener("mousedown",e)},[]);let U=M[I]||"Dashboard";return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("nav",{className:"bg-white shadow-md text-gray-600 relative z-50",children:[(0,a.jsxs)("div",{className:"container mx-auto px-4 py-3 flex justify-between items-center",children:[(0,a.jsxs)("div",{className:"flex items-center",children:[(0,a.jsx)("button",{className:"md:hidden text-gray-600 mr-3",onClick:()=>t(!e),children:e?(0,a.jsx)(n.A,{className:"w-6 h-6"}):(0,a.jsx)(c.A,{className:"w-6 h-6"})}),(0,a.jsxs)("div",{className:"hidden md:flex space-x-6",children:[Object.keys(M).map(e=>"/dtr"!==e&&"/leaves"!==e&&"/dtr-problem"!==e&&"/overtime"!==e?(0,a.jsx)(l(),{href:e,className:`${I===e?"text-black":"text-gray-600"} hover:text-black px-3 py-2 rounded`,children:M[e]},e):null),(0,a.jsxs)("div",{className:"relative dropdown-container",children:[(0,a.jsxs)("button",{onClick:()=>N(!w),className:`text-gray-600 hover:text-black px-3 py-2 rounded flex items-center space-x-1 ${"/dtr"===I||"/leaves"===I||w?"text-black":""}`,children:[(0,a.jsx)("span",{children:"Time Keeping"}),(0,a.jsx)(d,{className:"w-4 h-4"})]}),w&&(0,a.jsxs)("div",{className:"absolute left-24 mt-2 w-48 bg-white text-black rounded-lg shadow-lg",children:[(0,a.jsx)(l(),{href:"/dtr",className:"block px-4 py-2 hover:bg-gray-200",children:"Daily Time Record"}),(0,a.jsx)(l(),{href:"/leaves",className:"block px-4 py-2 hover:bg-gray-200",children:"Leaves"}),(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsxs)("button",{onClick:()=>T(!k),className:"block hover:bg-gray-200 px-3 py-2 rounded flex items-center space-x-1 w-full",children:[(0,a.jsx)("span",{children:"Forms"}),(0,a.jsx)(d,{className:"w-4 h-4"})]}),k&&(0,a.jsxs)("div",{className:"absolute left-24 mt-2 w-48 bg-white text-black rounded-lg shadow-lg",children:[(0,a.jsx)(l(),{href:"/dtr-problem",className:"block px-4 py-2 hover:bg-gray-200",children:"Daily Time Record Problem"}),(0,a.jsx)(l(),{href:"/overtime",className:"block px-4 py-2 hover:bg-gray-200",children:"Over Time"})]})]})]})]})]})]}),(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsxs)("button",{className:"flex items-center space-x-2 text-gray-600",onClick:()=>r(!s),children:[(0,a.jsx)("div",{className:"avatar avatar-online",children:(0,a.jsx)("div",{className:"w-9 h-9 rounded-full ring ",children:(0,a.jsx)(p.default,{src:"/img/user-icon.png",alt:"User Icon",width:60,height:60,className:"w-14 h-14 mr-4"})})}),(0,a.jsx)("span",{children:O?.name||"Guest"})]}),s&&(0,a.jsxs)("div",{className:"absolute right-0 mt-2 w-48 bg-white text-black rounded-lg shadow-lg",children:[(0,a.jsx)("div",{className:"p-2 border-b",children:(0,a.jsx)("p",{className:"text-xs text-gray-500",children:O?O.email:"Guest"})}),(0,a.jsxs)("button",{onClick:G,className:"w-full text-left px-4 py-2 text-red-600 hover:bg-gray-100 flex items-center",children:[(0,a.jsx)(m.A,{className:"w-5 h-5 mr-2"}),"Logout"]})]})]})]}),(0,a.jsxs)("div",{className:`${e?"block":"hidden"} md:hidden bg-[#135D66] py-2 bg-white shadow-md text-gray-600`,children:[Object.keys(M).map(e=>"/dtr"!==e&&"/leaves"!==e&&"/dtr-problem"!==e&&"/overtime"!==e?(0,a.jsx)(l(),{href:e,className:`${I===e?"text-black":"text-gray-600"} block px-4 py-2 hover:text-black`,children:M[e]},e):null),(0,a.jsxs)("div",{className:"border-t bg-white shadow-md text-gray-600 mt-2",children:[(0,a.jsx)("p",{className:`px-4 py-2 font-semibold ${"/dtr"===I||"/leaves"===I||w?"text-black":"text-gray-600"}`,children:"Time Keeping"}),(0,a.jsx)(l(),{href:"/dtr",className:"block px-4 py-2 hover:text-black",children:"Daily Time Record"}),(0,a.jsx)(l(),{href:"/leaves",className:"block px-4 py-2 hover:text-black",children:"Leaves"}),(0,a.jsxs)("div",{className:"border-t bg-white shadow-md text-gray-600 mt-2",children:[(0,a.jsx)("p",{className:"px-4 py-2 text-gray-600 font-semibold",children:"Forms"}),(0,a.jsx)(l(),{href:"/dtr-problem",className:"block px-4 py-2 text-gray-600 hover:text-black",children:"Daily Time Record Problem"}),(0,a.jsx)(l(),{href:"/overtime",className:"block px-4 py-2 text-gray-600 hover:text-black",children:"Over Time"})]})]})]}),g&&(0,a.jsxs)("div",{className:"absolute top-4 right-4 bg-green-600 text-white p-3 rounded-lg shadow-lg flex items-center",children:[(0,a.jsx)(x.A,{className:"w-5 h-5 mr-2"}),"Logging out"]})]}),(0,a.jsxs)("div",{className:"container mx-auto mt-6 p-6 bg-gray-700 shadow-xl flex justify-between items-center",children:[(0,a.jsx)("h1",{className:"text-xl font-semibold text-white",children:U}),(0,a.jsxs)("div",{className:"flex items-center space-x-4 text-sm",children:[(0,a.jsx)("span",{className:"text-gray-300",children:f}),(0,a.jsx)("button",{onClick:z,className:`${"Time Out"===A?"bg-red-600":"bg-purple-600"} text-white px-4 py-1 rounded-full flex items-center`,children:A}),(0,a.jsx)("span",{className:"text-gray-300",children:b})]})]}),J&&(0,a.jsx)(u.A,{})]})}},70440:(e,t,s)=>{s.r(t),s.d(t,{default:()=>r});var a=s(88077);let r=async e=>[{type:"image/x-icon",sizes:"16x16",url:(0,a.fillMetadataSegment)(".",await e.params,"favicon.ico")+""}]}};
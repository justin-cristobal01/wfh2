"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[8640],{58640:(e,t,a)=>{a.r(t),a.d(t,{default:()=>g});var s=a(95155),r=a(48173),l=a.n(r),o=a(12115),c=a(76046),n=a(689),i=a(87936),d=a(32645),m=a(21354),h=a(13261),x=a(1865),u=a(74134),p=a(5565);let g=()=>{let[e,t]=(0,o.useState)(!1),[a,r]=(0,o.useState)(!1),[g,b]=(0,o.useState)(!1),[y,v]=(0,o.useState)(""),[f,j]=(0,o.useState)(""),[w,N]=(0,o.useState)(!1),[k,T]=(0,o.useState)(!1),S=(0,c.useRouter)(),I=(0,c.usePathname)(),[O,D]=(0,o.useState)(null),C=(0,o.useContext)(x.p),[A,E]=(0,o.useState)("Time In"),[P,L]=(0,o.useState)(!1),[R,J]=(0,o.useState)(!1),[F,_]=(0,o.useState)(!1),G={"/dashboard":"Dashboard","/activityMonitoring":"Activity Monitoring","/dtr":"Daily Time Record","/leaves":"Leaves","/dtr-problem":"Daily Time Record Problem","/overtime":"Overtime"};(0,o.useEffect)(()=>{let e=localStorage.getItem("user");e&&D(JSON.parse(e)),(async()=>{try{if(!e){console.error("User not found in localStorage.");return}let t=JSON.parse(e).employeeId,a=await fetch("/employeeAPI/dtr?employeeId=".concat(t));if(!a.ok)throw Error("Server error: ".concat(a.status," ").concat(a.statusText));let s=await a.json();console.log("Fetched last DTR:",s),s&&null===s.timeOut?(E("Time Out"),J(!0)):(E("Time In"),J(!1))}catch(e){console.error("Error fetching last DTR:",e)}})()},[]),(0,o.useEffect)(()=>{let e=localStorage.getItem("user"),t=async()=>{if("Time Out"===A&&e){let t=JSON.parse(e).employeeId,a=new Date;await fetch("/employeeAPI/dtr",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({employeeId:t,timeOut:a,remarks:"Auto clock-out due to page close"})})}};return window.addEventListener("beforeunload",t),()=>{window.removeEventListener("beforeunload",t)}},[A]);let M=async()=>{try{let e;let t=localStorage.getItem("user");if(!t){S.push("/");return}let a=JSON.parse(t).employeeId,s=new Date;if(console.log(a+"employee ID hereeeeee"),"Time In"===A){if(C)await C.startCamera(),J(!0),e={employeeId:a,timeIn:s,timeOut:null,remarks:""};else{console.log("Camera permission not granted or camera context unavailable.");return}}else"Time Out"===A&&(C&&(await C.stopCamera(),_(!1),J(!1)),e={employeeId:a,timeOut:s,remarks:"Clocked out"});(await fetch("/employeeAPI/dtr",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)})).ok?E("Time In"===A?"Time Out":"Time In"):console.error("Failed to log action")}catch(e){console.error("Error logging action:",e)}},U=async()=>{let e=localStorage.getItem("user");if(r(!1),b(!0),"Time Out"===A&&e){let t=JSON.parse(e).employeeId,a=new Date;await fetch("/employeeAPI/dtr",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({employeeId:t,timeOut:a,remarks:"Auto clock-out due to logout"})}),E("Time In")}setTimeout(()=>{b(!1),localStorage.removeItem("authToken"),localStorage.removeItem("user"),C&&C.stopCamera(),S.push("/")},2e3)};(0,o.useEffect)(()=>{let e=setInterval(()=>{v(new Date().toLocaleTimeString("en-US",{hour12:!1}))},1e3);return()=>clearInterval(e)},[]),(0,o.useEffect)(()=>{let e=new Date,t=Intl.DateTimeFormat().resolvedOptions().timeZone,a=-e.getTimezoneOffset()/60;j("GMT ".concat(a>=0?"+":"").concat(a,":00 ").concat(t))},[]),(0,o.useEffect)(()=>{let e=e=>{e.target.closest(".dropdown-container")||(N(!1),T(!1),L(!1))};return document.addEventListener("mousedown",e),()=>document.removeEventListener("mousedown",e)},[]);let z=G[I]||"Dashboard";return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)("nav",{className:"bg-white shadow-md text-gray-600 relative z-50",children:[(0,s.jsxs)("div",{className:"container mx-auto px-4 py-3 flex justify-between items-center",children:[(0,s.jsxs)("div",{className:"flex items-center",children:[(0,s.jsx)("button",{className:"md:hidden text-gray-600 mr-3",onClick:()=>t(!e),children:e?(0,s.jsx)(n.A,{className:"w-6 h-6"}):(0,s.jsx)(i.A,{className:"w-6 h-6"})}),(0,s.jsxs)("div",{className:"hidden md:flex space-x-6",children:[Object.keys(G).map(e=>"/dtr"!==e&&"/leaves"!==e&&"/dtr-problem"!==e&&"/overtime"!==e?(0,s.jsx)(l(),{href:e,className:"".concat(I===e?"text-black":"text-gray-600"," hover:text-black px-3 py-2 rounded"),children:G[e]},e):null),(0,s.jsxs)("div",{className:"relative dropdown-container",children:[(0,s.jsxs)("button",{onClick:()=>N(!w),className:"text-gray-600 hover:text-black px-3 py-2 rounded flex items-center space-x-1 ".concat("/dtr"===I||"/leaves"===I||w?"text-black":""),children:[(0,s.jsx)("span",{children:"Time Keeping"}),(0,s.jsx)(d.A,{className:"w-4 h-4"})]}),w&&(0,s.jsxs)("div",{className:"absolute left-24 mt-2 w-48 bg-white text-black rounded-lg shadow-lg",children:[(0,s.jsx)(l(),{href:"/dtr",className:"block px-4 py-2 hover:bg-gray-200",children:"Daily Time Record"}),(0,s.jsx)(l(),{href:"/leaves",className:"block px-4 py-2 hover:bg-gray-200",children:"Leaves"}),(0,s.jsxs)("div",{className:"relative",children:[(0,s.jsxs)("button",{onClick:()=>T(!k),className:"block hover:bg-gray-200 px-3 py-2 rounded flex items-center space-x-1 w-full",children:[(0,s.jsx)("span",{children:"Forms"}),(0,s.jsx)(d.A,{className:"w-4 h-4"})]}),k&&(0,s.jsxs)("div",{className:"absolute left-24 mt-2 w-48 bg-white text-black rounded-lg shadow-lg",children:[(0,s.jsx)(l(),{href:"/dtr-problem",className:"block px-4 py-2 hover:bg-gray-200",children:"Daily Time Record Problem"}),(0,s.jsx)(l(),{href:"/overtime",className:"block px-4 py-2 hover:bg-gray-200",children:"Over Time"})]})]})]})]})]})]}),(0,s.jsxs)("div",{className:"relative",children:[(0,s.jsxs)("button",{className:"flex items-center space-x-2 text-gray-600",onClick:()=>r(!a),children:[(0,s.jsx)("div",{className:"avatar avatar-online",children:(0,s.jsx)("div",{className:"w-9 h-9 rounded-full ring ",children:(0,s.jsx)(p.default,{src:"/img/user-icon.png",alt:"User Icon",width:60,height:60,className:"w-14 h-14 mr-4"})})}),(0,s.jsx)("span",{children:(null==O?void 0:O.name)||"Guest"})]}),a&&(0,s.jsxs)("div",{className:"absolute right-0 mt-2 w-48 bg-white text-black rounded-lg shadow-lg",children:[(0,s.jsx)("div",{className:"p-2 border-b",children:(0,s.jsx)("p",{className:"text-xs text-gray-500",children:O?O.email:"Guest"})}),(0,s.jsxs)("button",{onClick:U,className:"w-full text-left px-4 py-2 text-red-600 hover:bg-gray-100 flex items-center",children:[(0,s.jsx)(m.A,{className:"w-5 h-5 mr-2"}),"Logout"]})]})]})]}),(0,s.jsxs)("div",{className:"".concat(e?"block":"hidden"," md:hidden bg-[#135D66] py-2 bg-white shadow-md text-gray-600"),children:[Object.keys(G).map(e=>"/dtr"!==e&&"/leaves"!==e&&"/dtr-problem"!==e&&"/overtime"!==e?(0,s.jsx)(l(),{href:e,className:"".concat(I===e?"text-black":"text-gray-600"," block px-4 py-2 hover:text-black"),children:G[e]},e):null),(0,s.jsxs)("div",{className:"border-t bg-white shadow-md text-gray-600 mt-2",children:[(0,s.jsx)("p",{className:"px-4 py-2 font-semibold ".concat("/dtr"===I||"/leaves"===I||w?"text-black":"text-gray-600"),children:"Time Keeping"}),(0,s.jsx)(l(),{href:"/dtr",className:"block px-4 py-2 hover:text-black",children:"Daily Time Record"}),(0,s.jsx)(l(),{href:"/leaves",className:"block px-4 py-2 hover:text-black",children:"Leaves"}),(0,s.jsxs)("div",{className:"border-t bg-white shadow-md text-gray-600 mt-2",children:[(0,s.jsx)("p",{className:"px-4 py-2 text-gray-600 font-semibold",children:"Forms"}),(0,s.jsx)(l(),{href:"/dtr-problem",className:"block px-4 py-2 text-gray-600 hover:text-black",children:"Daily Time Record Problem"}),(0,s.jsx)(l(),{href:"/overtime",className:"block px-4 py-2 text-gray-600 hover:text-black",children:"Over Time"})]})]})]}),g&&(0,s.jsxs)("div",{className:"absolute top-4 right-4 bg-green-600 text-white p-3 rounded-lg shadow-lg flex items-center",children:[(0,s.jsx)(h.A,{className:"w-5 h-5 mr-2"}),"Logging out"]})]}),(0,s.jsxs)("div",{className:"container mx-auto mt-6 p-6 bg-gray-700 shadow-xl flex justify-between items-center",children:[(0,s.jsx)("h1",{className:"text-xl font-semibold text-white",children:z}),(0,s.jsxs)("div",{className:"flex items-center space-x-4 text-sm",children:[(0,s.jsx)("span",{className:"text-gray-300",children:f}),(0,s.jsx)("button",{onClick:M,className:"".concat("Time Out"===A?"bg-red-600":"bg-purple-600"," text-white px-4 py-1 rounded-full flex items-center"),children:A}),(0,s.jsx)("span",{className:"text-gray-300",children:y})]})]}),F&&(0,s.jsx)(u.A,{})]})}}}]);
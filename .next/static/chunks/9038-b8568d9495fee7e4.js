(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[9038],{21351:()=>{},85817:()=>{},18590:()=>{},83857:()=>{},94637:()=>{},279:()=>{},4222:()=>{},23053:()=>{},1865:(e,t,r)=>{"use strict";r.d(t,{p:()=>i,L:()=>s});var n=r(95155),a=r(12115),o=r(66667);r(39056);let l=e=>{let{isOpen:t,onClose:r,setMessage:a}=e;return t?(0,n.jsx)("div",{className:"fixed inset-0 flex items-center justify-center bg-black bg-opacity-50",children:(0,n.jsxs)("div",{className:"bg-white p-6 rounded-lg shadow-lg",children:[(0,n.jsx)("h2",{className:"text-lg font-bold",children:"Attention!"}),(0,n.jsx)("p",{className:"mt-2",children:a}),(0,n.jsx)("div",{className:"mt-4 flex justify-end",children:(0,n.jsx)("button",{onClick:r,className:"px-4 py-2 bg-blue-500 text-white rounded-lg",children:"Confirm"})})]})}):null},i=(0,a.createContext)(null),s=e=>{let{children:t}=e,s=(0,a.useRef)(null),[c,u]=(0,a.useState)(null),[d,g]=(0,a.useState)(!1),[m,h]=(0,a.useState)(null),[y,p]=(0,a.useState)(!1),[w,f]=(0,a.useState)({x:0,y:0}),S=(0,a.useRef)(null),v=(0,a.useRef)(!1),[x,E]=(0,a.useState)(!1),I=(0,a.useRef)(null),b=(0,a.useRef)(new Set),[k,j]=(0,a.useState)(!1);(0,a.useRef)(null);let N=(0,a.useRef)(!1),[T,L]=(0,a.useState)(""),[M,P]=(0,a.useState)(0),[U,C]=(0,a.useState)(0),[D,A]=(0,a.useState)(!1),[F,O]=(0,a.useState)(!1),R=(0,a.useRef)(null),[Y,H]=(0,a.useState)(""),[J,W]=(0,a.useState)(""),z=async()=>{await fetch("/employerAPI/getEmployeeStatus?employeeId=".concat(T),{method:"PUT",headers:{"Content-Type":"application/json"}})},_=async e=>{if(N.current=e,j(!1),e){"Sleeping"===J?(X("User is sleeping","Sleeping"),P(0),A(!1),Z()):"Idle"===J&&(X("User is out of area","Idle"),C(0),O(!1),Z()),b.current.clear();return}};(0,a.useEffect)(()=>{k&&("Idle"===J?H("Are you still there? Please confirm your presence"):"Sleeping"===J&&H("Are you asleep? Please confirm your presence"),$())},[k,J]);let[q,V]=(0,a.useState)(()=>({x:window.innerWidth-120,y:window.innerHeight-100}));(0,a.useEffect)(()=>{let e=localStorage.getItem("user");if(e)try{let t=JSON.parse(e);L(t.employeeId)}catch(e){console.error("Error parsing user data:",e)}},[]);let X=async(e,t)=>{if(!T){console.warn("Employee ID not found. Skipping update.");return}try{let r=new Date().toISOString(),n=await fetch("/employeeAPI/humanActivityLog?activity=".concat(t,"&employeeId=").concat(T),{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({end:r,remarks:e})});if(b.current.clear(),!n.ok)throw Error("Failed to update activity");let a=await n.json();console.log("Activity updated successfully:",a)}catch(e){console.error("❌ Error updating activity:",e)}},G=async e=>{if(!T){console.warn("Employee ID not found. Skipping log.");return}if("Yawning"!==e){if(b.current.has(e)){console.log('Activity "'.concat(e,'" already logged. Skipping.'));return}b.current.add(e)}try{let t=new Date().toISOString(),r=null,n=null;if("Yawning"===e&&(r=new Date().toISOString(),n="User is Yawning"),!(await fetch("/employeeAPI/humanActivityLog",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({activity:e,employeeId:T,start:t,end:r,remarks:n})})).ok)throw Error("Failed to log activity")}catch(e){console.error("❌ Error logging activity:",e)}};(0,a.useEffect)(()=>{let e=()=>{V(e=>({x:Math.min(e.x,window.innerWidth-150),y:Math.min(e.y,window.innerHeight-120)}))};return window.addEventListener("resize",e),()=>window.removeEventListener("resize",e)},[]);let B=e=>{y&&V(t=>({x:Math.max(0,Math.min(e.clientX-w.x,window.innerWidth-150)),y:Math.max(0,Math.min(e.clientY-w.y,window.innerHeight-120))}))},K=()=>p(!1);(0,a.useEffect)(()=>(window.addEventListener("mousemove",B),window.addEventListener("mouseup",K),()=>{window.removeEventListener("mousemove",B),window.removeEventListener("mouseup",K)}),[y]),(0,a.useEffect)(()=>{(async()=>{try{let e=await Promise.all([r.e(4161),r.e(6075)]).then(r.bind(r,59097));h(e),await o.jh6("webgl"),await o.Gc4(),await Q(e),g(!0)}catch(e){console.error("❌ Error initializing Face API:",e)}})()},[]);let Q=async e=>{try{await e.nets.tinyFaceDetector.loadFromUri("/models"),await e.nets.faceLandmark68Net.loadFromUri("/models"),await e.nets.faceRecognitionNet.loadFromUri("/models"),await e.nets.ssdMobilenetv1.loadFromUri("/models")}catch(e){console.error("❌ Error loading Face API models:",e)}},Z=async()=>{try{if(v.current)return;let e=await navigator.permissions.query({name:"camera"});if("denied"===e.state){console.error("❌ Camera access denied by user.");return}c&&(c.getTracks().forEach(e=>e.stop()),u(null));let t=await navigator.mediaDevices.getUserMedia({video:!0});u(t),v.current=!0;let r=async()=>new Promise(e=>{let r=()=>{s.current?(s.current.srcObject=t,e()):requestAnimationFrame(r)};r()});await r()}catch(e){console.error("❌ Error accessing camera:",e)}},$=()=>{c&&(c.getTracks().forEach(e=>e.stop()),u(null),v.current=!1)},ee=async()=>{if(!s.current||!d||!m||!I.current)return;let e=s.current,t=I.current,r=t.getContext("2d"),n=S.current;n&&(t.width=n.clientWidth,t.height=n.clientHeight),null==r||r.clearRect(0,0,t.width,t.height);try{let t=await m.detectSingleFace(e,new m.TinyFaceDetectorOptions).withFaceLandmarks().withFaceDescriptor();if(t&&t.landmarks)F&&k&&(C(0),O(!1));else{console.log("No face detected"),C(e=>{let t=e+1;return console.log("Idle Timer: ".concat(t)),!(t>=10)||F||k||(console.log("User is out of area"),G("Idle"),"Idle"!==J&&W("Idle"),O(!0),j(!0)),t});return}let r=t.landmarks,n=r.getMouth()[13];if(r.getMouth()[19].y-n.y>20){let e=Date.now();(!R.current||e-R.current>=5e3)&&(console.log("User is yawning"),G("Yawning"),R.current=e)}let a=r.getLeftEye(),o=r.getRightEye(),l=a[1].y-a[5].y,i=a[3].x-a[0].x,s=l/i,c=o[1].y-o[5].y,u=o[3].x-o[0].x,d=c/u;console.log("left eye: "+s+" right eye: "+d),s>-.28&&d>-.28?P(e=>{let t=e+1;return console.log("Sleeping Timer: ".concat(t)),!(t>=10)||D||k||(console.log("User is sleeping"),G("Sleeping"),"Sleeping"!==J&&W("Sleeping"),A(!0),j(!0)),t}):(P(0),D&&k&&A(!1))}catch(e){console.error("❌ Error detecting face:",e)}};return(0,a.useEffect)(()=>{let e=setInterval(()=>{ee()},1e3);return()=>clearInterval(e)},[d,m]),(0,n.jsxs)(i.Provider,{value:{videoRef:s,startCamera:Z,stopCamera:$,stream:c},children:[t,c&&(0,n.jsxs)("div",{ref:S,title:"Drag me everywhere or double click me to view larger...",className:"fixed cursor-pointer",style:{left:"".concat(q.x,"px"),top:"".concat(q.y,"px"),width:x?"300px":"100px",height:x?"280px":"80px",zIndex:1e3},onMouseDown:e=>{p(!0),f({x:e.clientX-q.x,y:e.clientY-q.y})},onDoubleClick:()=>{E(e=>{let t=!e;return t?V({x:(window.innerWidth-200)/2,y:(window.innerHeight-200)/2}):V(e=>({x:Math.min(e.x,window.innerWidth-150),y:Math.min(e.y,window.innerHeight-120)})),t})},children:[(0,n.jsx)("video",{ref:s,autoPlay:!0,playsInline:!0,muted:!0,className:"w-full h-full border rounded-md shadow-md bg-black"}),(0,n.jsx)("canvas",{ref:I,className:"absolute top-0 left-0"})]}),(0,n.jsx)(l,{isOpen:k,onClose:()=>{_(!0),z()},refresh:()=>{},setMessage:Y})]})}},74134:(e,t,r)=>{"use strict";r.d(t,{A:()=>a});var n=r(12115);function a(){let e=(0,n.useRef)(null),[t,r]=(0,n.useState)(null),[a,o]=(0,n.useState)(()=>JSON.parse(localStorage.getItem("user")||"null")),l=async e=>{try{let r=null==t?void 0:t.getVideoTracks()[0];if(!r)return;let n=new ImageCapture(r),a=await n.grabFrame(),o=document.createElement("canvas");o.width=a.width,o.height=a.height;let l=o.getContext("2d");null==l||l.drawImage(a,0,0);let i=o.toDataURL("image/png"),s=await fetch("/employerAPI/screenShot",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({employeeId:e,screenCapture:i})}),c=await s.json();console.log("Screenshot sent:",c.message)}catch(e){}},i=()=>{localStorage.removeItem("permissionToShare"),e.current&&(clearInterval(e.current),e.current=null,console.log("Screenshot capturing stopped.")),t&&(t.getTracks().forEach(e=>e.stop()),r(null),console.log("Media stream stopped."))};return(0,n.useEffect)(()=>{(async()=>{if(a&&"EMPLOYEE"===a.role){if(console.log("User role:",a.role),!t)try{let e=await navigator.mediaDevices.getDisplayMedia({video:{mediaSource:"screen"}});r(e);let t=e.getVideoTracks()[0];console.log("User selected:",t.getSettings().displaySurface),t.addEventListener("ended",()=>{console.log("User stopped screen sharing."),r(null),i()})}catch(e){console.log(t),localStorage.setItem("permissionToShare","false")}t&&localStorage.setItem("permissionToShare","true"),e.current=setInterval(()=>{localStorage.getItem("user")?l(a.employeeId):i()},1e4)}else i()})();let n=()=>{o(JSON.parse(localStorage.getItem("user")||"null"))};return window.addEventListener("storage",n),()=>{i(),window.removeEventListener("storage",n)}},[a,t]),null}}}]);
(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[1317],{62861:(e,t,s)=>{Promise.resolve().then(s.bind(s,35898))},35898:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>o});var a=s(95155),l=s(35781),r=s(76472),n=s(93137),i=s(12115),c=s(76046);l.t1.register(l.Bs,l.m_,l.s$);let o=()=>{let[e,t]=(0,i.useState)(null),[s,l]=(0,i.useState)(""),[o,d]=(0,i.useState)([]),[m,x]=(0,i.useState)({idle:0,sleeping:0}),[h,u]=(0,i.useState)([]),[g,p]=(0,i.useState)([]),[f,j]=(0,i.useState)([]),y=(0,c.useRouter)();(0,i.useEffect)(()=>{let e=localStorage.getItem("authToken");l(new Date().toLocaleDateString("en-PH",{year:"numeric",month:"long",day:"numeric",timeZone:"Asia/Manila"})),e?(b(),v()):y.push("/")},[]);let b=async()=>{let e=new EventSource("/employerAPI/realTimeLogs");try{let t=await fetch("/employerAPI/employee");if(!t.ok)throw Error("Failed to fetch employees");let s=await t.json(),a=await fetch("/employerAPI/humanActivityLog");if(!t.ok)throw Error("Failed to fetch employees");let l=await a.json();e.onmessage=e=>{try{let t=JSON.parse(e.data);u(t)}catch(e){console.error("❌ Error parsing activity logs:",e)}},e.onerror=t=>{console.error("❌ SSE connection error:",t),e.close()};let r=l.reduce((e,t)=>("Idle"===t.activity?e.idle+=t.duration:"Sleeping"===t.activity&&(e.sleeping+=t.duration),e),{idle:0,sleeping:0});console.log("Total Idle Duration:",r.idle),console.log("Total Sleeping Duration:",r.sleeping),x(r);let n=await fetch("/employerAPI/user");if(!n.ok)throw Error("Failed to fetch users");let i=await n.json(),c=s.map(e=>{let t=i.find(t=>t.email===e.email);return t?{...e,status:t.status,employeeId:t.employeeId,password:t.password,role:t.role}:e});d(c),console.log(o)}catch(e){console.error("Error fetching employees or users:",e)}return()=>{e.close()}},N=()=>(o.length,{totalSleep:m.sleeping,totalIdle:m.idle}),v=async()=>{try{let e=await fetch("/employerAPI/notifications"),t=await e.json(),s=(t.latest||[]).sort((e,t)=>new Date(t.createdAt)-new Date(e.createdAt)),a=(t.pending||[]).sort((e,t)=>new Date(t.createdAt)-new Date(e.createdAt));p(s),j(a)}catch(e){console.error("Error fetching notification logs:",e),p([]),j([])}},w=e=>{if(console.log("Fetched Employees:",e),!e||0===e.length)return{labels:["No Data"],datasets:[{data:[100],backgroundColor:["#e0e0e0"]}]};let t={"On Leave":0,Idle:0,Sleeping:0,Active:0};return e.forEach(e=>{e.activityStatus in t?t[e.activityStatus]+=1:t[e.activityStatus]=1}),{labels:Object.keys(t),datasets:[{data:Object.values(t),backgroundColor:["#FF5733","#FFC107","blue","green"],hoverBackgroundColor:["#E64A19","#FFB300","#388E3C","green"]}]}};return(0,a.jsxs)("div",{className:"min-h-screen bg-white",children:[(0,a.jsx)(n.default,{}),(0,a.jsx)("div",{className:"container mx-auto p-4 mt-4",children:(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[(0,a.jsxs)("div",{className:"p-6 bg-white shadow-lg rounded-lg",children:[(0,a.jsx)("p",{className:"text-md text-gray-500 mb-2",children:s}),(0,a.jsx)("h2",{className:"text-lg font-semibold pb-3 text-gray-700",children:"Employee Activity Chart"}),(0,a.jsxs)("p",{className:"text-md text-gray-600 mb-2",children:["Total Employees: ",(0,a.jsx)("span",{className:"font-bold",children:o.length})]}),(0,a.jsxs)("div",{className:"flex items-center justify-center w-full",children:[(0,a.jsx)("div",{className:"w-[250px] sm:w-[280px] md:w-[300px] lg:w-[350px]",children:(0,a.jsx)(r.nu,{data:(e=>(console.log(e),e)?{labels:["Sleeping Time","Idle Time"],datasets:[{data:[m.sleeping,m.idle],backgroundColor:["#4CAF50","#FFC107"],hoverBackgroundColor:["#45a049","#ffca2c"]}]}:(N(),{labels:["No Data"],datasets:[{data:[100],backgroundColor:["#e0e0e0"]}]}))(o),options:{maintainAspectRatio:!1}})}),(0,a.jsxs)("div",{className:"ml-6 text-sm text-gray-700",children:[(0,a.jsxs)("p",{className:"font-bold text-orange-600",children:["Sleeping Time: ",m.sleeping]}),(0,a.jsxs)("p",{className:"font-bold text-yellow-500 mt-2",children:["Idle Time: ",m.idle]})]})]})]}),(0,a.jsx)("div",{className:"p-6 bg-white shadow-lg rounded-lg",children:(0,a.jsxs)("div",{className:"mt-4 p-3 bg-gray-100 rounded-lg h-80 overflow-auto text-sm",children:[(0,a.jsx)("h3",{className:"text-md font-semibold text-gray-700 mb-2",children:"Real-Time Log:"}),h.length>0?h.map((e,t)=>{let s=o.find(t=>t.employeeId===e.employeeId),l=s?s.name:"Unknown",r=new Date(e.start).toLocaleDateString("en-PH"),n=new Date(e.start).toLocaleTimeString("en-PH");return(0,a.jsxs)("p",{className:"text-gray-600",children:[(0,a.jsxs)("span",{className:"font-semibold",children:[r," ",n,": "]})," ".concat(l," is ").concat(e.activity.toLowerCase(),".")]},t)}):(0,a.jsx)("p",{className:"text-gray-500",children:"No recent activity logs."})]})}),(0,a.jsxs)("div",{className:"card bg-white shadow-md text-black p-6",children:[(0,a.jsx)("h1",{className:"text-xl font-bold mb-4",children:"NOTIFICATION LOGS"}),(0,a.jsx)("h2",{className:"font-semibold text-lg",children:"Latest Requests"}),(0,a.jsx)("hr",{className:"my-2 border-gray-300"}),g.length>0?g.slice(0,5).map((e,t)=>{let s=o.find(t=>t.employeeId===e.employeeId),l=s?s.name:"Unknown";return(0,a.jsxs)("p",{className:"text-yellow-600 border-b py-2",children:[(0,a.jsx)("span",{className:"cursor-pointer font-bold text-green-600 uppercase text-xs",children:l})," ",(0,a.jsxs)("span",{className:"text-xs",children:["filed a"," "]}),(0,a.jsxs)("span",{className:"cursor-pointer hover:text-yellow-400 text-xs",onClick:()=>handleNavigation(e.file_type),children:[e.file_type,": ",e.status," (",new Date(e.createdAt).toLocaleString(),")"]})]},t)}):(0,a.jsx)("p",{className:"text-gray-500",children:"No pending requests"}),g.length>5&&(0,a.jsx)("div",{className:"mt-2 text-right",children:(0,a.jsx)("a",{href:"/notifications",className:"text-blue-500 hover:underline text-sm",children:"More →"})}),(0,a.jsx)("h3",{className:"font-semibold text-lg mt-4",children:"Pending Requests"}),(0,a.jsx)("hr",{className:"my-2 border-gray-300"}),f.length>0?f.slice(0,5).map((e,t)=>{let s=o.find(t=>t.employeeId===e.employeeId),l=s?s.name:"Unknown";return(0,a.jsxs)("p",{className:"text-yellow-600 border-b py-2",children:[(0,a.jsx)("span",{className:"cursor-pointer font-bold text-green-600 uppercase text-xs",children:l})," ",(0,a.jsxs)("span",{className:"text-xs",children:["filed a"," "]}),(0,a.jsxs)("span",{className:"cursor-pointer hover:text-yellow-400 text-xs",onClick:()=>handleNavigation(e.file_type),children:[e.file_type,": ",e.status," (",new Date(e.createdAt).toLocaleString(),")"]})]},t)}):(0,a.jsx)("p",{className:"text-gray-500",children:"No pending requests"}),f.length>5&&(0,a.jsx)("div",{className:"mt-2 text-right",children:(0,a.jsx)("a",{href:"/notifications",className:"text-blue-500 hover:underline text-sm",children:"More →"})})]}),(0,a.jsxs)("div",{className:"p-6 bg-white shadow-lg rounded-lg",children:[(0,a.jsx)("p",{className:"text-md text-gray-500 mb-2",children:s}),(0,a.jsx)("h2",{className:"text-lg font-semibold pb-3 text-gray-700",children:"Employee Activity Chart"}),(0,a.jsxs)("p",{className:"text-md text-gray-600 mb-2",children:["Total Employees: ",(0,a.jsx)("span",{className:"font-bold",children:o.length})]}),(()=>{let e={Sleeping:0,Idle:0,"On Leave":0,Active:0};return o.forEach(t=>{t.activityStatus in e&&(e[t.activityStatus]+=1)}),(0,a.jsxs)("div",{className:"flex items-center justify-center w-full",children:[(0,a.jsx)("div",{className:"w-[250px] sm:w-[280px] md:w-[300px] lg:w-[350px]",children:(0,a.jsx)(r.nu,{data:w(o),options:{maintainAspectRatio:!1}})}),(0,a.jsxs)("div",{className:"ml-6 text-sm text-gray-700",children:[(0,a.jsxs)("div",{className:"flex items-center mt-2",children:[(0,a.jsx)("span",{className:"w-6 h-2 bg-red-500 rounded mr-2"}),(0,a.jsxs)("p",{className:"font-bold text-gray-500",children:["On Leave: ",e["On Leave"]]})]}),(0,a.jsxs)("div",{className:"flex items-center mt-2",children:[(0,a.jsx)("span",{className:"w-6 h-2 bg-yellow-500 rounded mr-2"}),(0,a.jsxs)("p",{className:"font-bold text-gray-500",children:["Idle: ",e.Idle]})]}),(0,a.jsxs)("div",{className:"flex items-center mt-2",children:[(0,a.jsx)("span",{className:"w-6 h-2 bg-blue-600 rounded mr-2"}),(0,a.jsxs)("p",{className:"font-bold text-gray-500",children:["Sleeping: ",e.Sleeping]})]}),(0,a.jsxs)("div",{className:"flex items-center mt-2",children:[(0,a.jsx)("span",{className:"w-6 h-2 bg-green-500 rounded mr-2"}),(0,a.jsxs)("p",{className:"font-bold text-gray-500",children:["Active: ",e.Active]})]})]})]})})()]})]})})]})}},93137:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>h});var a=s(95155),l=s(48173),r=s.n(l),n=s(12115),i=s(76046),c=s(689),o=s(87936),d=s(21354),m=s(13261),x=s(5565);let h=()=>{let[e,t]=(0,n.useState)(!1),[s,l]=(0,n.useState)(!1),[h,u]=(0,n.useState)(!1),[g,p]=(0,n.useState)(null),[f,j]=(0,n.useState)(!1),y=(0,i.useRouter)(),b=(0,i.usePathname)(),N={"/employerDashboard":"Dashboard","/employeeMonitoring":"Employee Monitoring","/approvalRequest":"Approval Request","/manageEmployee":"Manage Employee","/employerReports":"Reports","/screenCaptureMonitoring":"Screen Capture"},v=N[b]||"Dashboard";return(0,n.useEffect)(()=>{let e=localStorage.getItem("user");e&&p(JSON.parse(e))},[]),(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("nav",{className:"bg-white shadow-md text-gray-600 relative z-50",children:[(0,a.jsxs)("div",{className:"container mx-auto px-4 py-3 flex justify-between items-center",children:[(0,a.jsxs)("div",{className:"flex items-center",children:[(0,a.jsx)("button",{className:"md:hidden text-red mr-3",onClick:()=>t(!e),children:e?(0,a.jsx)(c.A,{className:"w-6 h-6"}):(0,a.jsx)(o.A,{className:"w-6 h-6"})}),(0,a.jsx)("div",{className:"hidden md:flex space-x-6",children:Object.keys(N).map(e=>(0,a.jsx)(r(),{href:e,className:"".concat(b===e?"bg-[#FFFFFF] text-gray-700 font-semibold text-lg":"text-gray-400 text-base"," hover:bg-[#FFFFFF] hover:text-black px-2 py-2 rounded"),children:N[e]},e))})]}),(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsxs)("button",{className:"flex items-center space-x-2 text-black",onClick:()=>l(!s),children:[(0,a.jsx)("div",{className:"avatar avatar-online",children:(0,a.jsx)("div",{className:"w-9 h-9 rounded-full ring ",children:(0,a.jsx)(x.default,{src:"/img/user-icon.png",alt:"User Icon",width:60,height:60,className:"w-14 h-14 mr-4"})})}),(0,a.jsx)("span",{className:"text-gray-600",children:g?g.name:"Loading..."})]}),s&&(0,a.jsxs)("div",{className:"absolute right-0 mt-2 w-48 bg-white text-black rounded-lg shadow-lg",children:[(0,a.jsxs)("div",{className:"p-2 border-b",children:[(0,a.jsx)("p",{className:"text-sm font-semibold",children:g?g.name:"Unknown"}),(0,a.jsx)("p",{className:"text-xs text-gray-500",children:g?g.email:"No Email"})]}),(0,a.jsxs)("button",{onClick:()=>{l(!1),u(!0),setTimeout(()=>{u(!1),localStorage.removeItem("user"),localStorage.removeItem("authToken"),y.push("/")},2e3)},className:"w-full text-left px-4 py-2 text-red-600 hover:bg-gray-100 flex items-center",children:[(0,a.jsx)(d.A,{className:"w-5 h-5 mr-2"}),"Logout"]})]})]})]}),(0,a.jsx)("div",{className:"".concat(e?"block":"hidden"," md:hidden bg-[#135D66] py-2"),children:Object.keys(N).map(e=>(0,a.jsx)(r(),{href:e,className:"".concat(b===e?"bg-[#0F4A55]":""," block px-4 py-2 text-white hover:bg-[#0F4A55]"),children:N[e]},e))}),h&&(0,a.jsxs)("div",{className:"absolute top-4 right-4 bg-green-600 text-white p-3 rounded-lg shadow-lg flex items-center",children:[(0,a.jsx)(m.A,{className:"w-5 h-5 mr-2"}),"Logging out..."]})]}),(0,a.jsx)("div",{className:"container mx-auto mt-6 p-6 bg-gray-700 shadow-xl flex justify-between items-center",children:(0,a.jsx)("h1",{className:"text-xl font-semibold text-white",children:v})})]})}},76472:(e,t,s)=>{"use strict";s.d(t,{N1:()=>d,nu:()=>m});var a=s(12115),l=s(35781);let r="label";function n(e,t){"function"==typeof e?e(t):e&&(e.current=t)}function i(e,t){let s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:r,a=[];e.datasets=t.map(t=>{let l=e.datasets.find(e=>e[s]===t[s]);return!l||!t.data||a.includes(l)?{...t}:(a.push(l),Object.assign(l,t),l)})}let c=(0,a.forwardRef)(function(e,t){let{height:s=150,width:c=300,redraw:o=!1,datasetIdKey:d,type:m,data:x,options:h,plugins:u=[],fallbackContent:g,updateMode:p,...f}=e,j=(0,a.useRef)(null),y=(0,a.useRef)(null),b=()=>{j.current&&(y.current=new l.t1(j.current,{type:m,data:function(e){var t;let s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:r,a={labels:[],datasets:[]};return t=e.labels,a.labels=t,i(a,e.datasets,s),a}(x,d),options:h&&{...h},plugins:u}),n(t,y.current))},N=()=>{n(t,null),y.current&&(y.current.destroy(),y.current=null)};return(0,a.useEffect)(()=>{!o&&y.current&&h&&function(e,t){let s=e.options;s&&t&&Object.assign(s,t)}(y.current,h)},[o,h]),(0,a.useEffect)(()=>{if(!o&&y.current){var e,t;e=y.current.config.data,t=x.labels,e.labels=t}},[o,x.labels]),(0,a.useEffect)(()=>{!o&&y.current&&x.datasets&&i(y.current.config.data,x.datasets,d)},[o,x.datasets]),(0,a.useEffect)(()=>{y.current&&(o?(N(),setTimeout(b)):y.current.update(p))},[o,h,x.labels,x.datasets,p]),(0,a.useEffect)(()=>{y.current&&(N(),setTimeout(b))},[m]),(0,a.useEffect)(()=>(b(),()=>N()),[]),a.createElement("canvas",{ref:j,role:"img",height:s,width:c,...f},g)});function o(e,t){return l.t1.register(t),(0,a.forwardRef)((t,s)=>a.createElement(c,{...t,ref:s,type:e}))}let d=o("line",l.ZT),m=o("doughnut",l.ju)}},e=>{var t=t=>e(e.s=t);e.O(0,[5647,8376,2675,8441,1517,7358],()=>t(62861)),_N_E=e.O()}]);
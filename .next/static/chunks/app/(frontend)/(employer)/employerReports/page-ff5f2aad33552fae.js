(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[3170],{26838:(e,t,a)=>{Promise.resolve().then(a.bind(a,30445))},30445:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>h});var s=a(95155),l=a(93137),n=a(12115),c=a(10142),r=a(42531),o=a(76046),i=a(10670),d=a.n(i),x=a(38003);let h=()=>{let[e,t]=(0,n.useState)(""),[a,i]=(0,n.useState)(""),[h,m]=(0,n.useState)(1),[p,b]=(0,n.useState)([]),[u,g]=(0,n.useState)(!1),[y,j]=(0,n.useState)([]),[N,f]=(0,n.useState)([]),w=(0,o.useRouter)(),v=Math.ceil(y.length/5),k=(h-1)*5,F=y.slice(k,k+5),S=e=>{b(t=>{let a=t.includes(e)?t.filter(t=>t!==e):[...t,e];return g(a.length===y.length),a})},A=async()=>{try{let e=await fetch("/employerAPI/employee");if(!e.ok)throw Error("Failed to fetch employees");let t=await e.json();j(t)}catch(e){console.error("Error fetching employees:",e)}};(0,n.useEffect)(()=>{localStorage.getItem("authToken")?A():w.push("/")},[]);let E=async(e,t,a)=>{try{let s=await fetch("/employerAPI/checkAttendance?employeeId=".concat(e,"&startDate=").concat(t,"&endDate=").concat(a));if(!s.ok)throw Error("Failed to fetch attendance data");let l=await s.json(),n=l.employees||[];if(!Array.isArray(n))return console.warn("Unexpected attendance data format for Employee ID: ".concat(e),l),[];return n}catch(e){return console.error("Error fetching attendance data:",e),[]}},I=async()=>{if(console.log("Generate report clicked"),0===p.length){alert("No employees selected.");return}let t=new(d()),s=0;for(let l of p){console.log("Fetching attendance for Employee ID: ".concat(l));let n=y.find(e=>e.employeeId===l);if(!n){console.warn("Employee not found for ID: ".concat(l));continue}let o=await E(l,e,a);if(!o||0===o.length){console.warn("No attendance data found for ".concat(n.name));continue}let i=await fetch("/employerAPI/humanActivityLog");if(!i.ok)throw Error("Failed to fetch employees");let d=(await i.json()).reduce((e,t)=>("Idle"===t.activity?e.idle+=t.duration:"Sleeping"===t.activity&&(e.sleeping+=t.duration),e),{idle:0,sleeping:0});console.log("Generating PDF for ".concat(n.name));let x=new c.Ay,h=0,m=o.map(e=>{let t=e.timeIn?new Date(e.timeIn):null,a=e.timeOut?new Date(e.timeOut):null,s=e.remarks||"N/A",l=0;return"On Leave"!==s&&t&&a&&(h+=l=(a-t)/36e5),[new Date(e.date).toLocaleDateString(),t?t.toLocaleString("en-US",{hour12:!0}):"N/A",a?a.toLocaleString("en-US",{hour12:!0}):"N/A",s,l.toFixed(2)]});(0,r.Ay)(x,{startY:80,head:[["Date","Check-In","Check-Out","Status","Rendered Hours"]],body:m}),x.setFontSize(18),x.setFont("helvetica","bold"),x.text("Attendance Report",105,15,{align:"center"}),x.setFontSize(14),x.setFont("helvetica","bold"),x.text("".concat(n.name),105,25,{align:"center"}),x.setLineWidth(.5),x.line(14,35,196,35),x.setFontSize(12),x.setFont("helvetica","bold"),x.text("Total Rendered Hours:",14,40),x.setFont("helvetica","normal"),x.text("".concat(h.toFixed(2)," hrs"),70,40),x.setFont("helvetica","bold"),x.text("Total Sleep Hours:",14,50),x.setFont("helvetica","normal"),x.setTextColor(0,102,204),x.text("".concat(d.sleeping.toFixed(2)," hrs"),70,50),x.setFont("helvetica","bold"),x.setTextColor(0,0,0),x.text("Total Idle Hours:",14,60),x.setFont("helvetica","normal"),x.setTextColor(255,51,51),x.text("".concat(d.idle.toFixed(2)," hrs"),70,60),x.setTextColor(0,0,0),console.log("Saving PDF for ".concat(n.name));let p="".concat(n.name.replace(/[^a-zA-Z0-9_ ]/g,""),"_").concat(e.replace(/[:]/g,"-"),"_").concat(a.replace(/[:]/g,"-"),".pdf"),b=await x.output("blob");t.file(p,b),s++}s>0?(console.log("Generating ZIP file with ".concat(s," PDFs...")),t.generateAsync({type:"blob"}).then(e=>{(0,x.saveAs)(e,"Employee_Attendance_Reports.zip"),console.log("ZIP file downloaded!")})):console.log("No PDFs were generated.")};return(0,s.jsxs)("div",{className:"min-h-screen shadow-md bg-white",children:[(0,s.jsx)(l.default,{}),(0,s.jsx)("div",{className:"container mx-auto p-4 mt-4",children:(0,s.jsx)("div",{className:"space-y-4",children:(0,s.jsxs)("div",{className:"custom-card-bg shadow-md text-white shadow-xl p-6 rounded-lg",children:[(0,s.jsx)("h2",{className:"text-xl font-semibold mb-4",children:"EMPLOYEE ATTENDANCE"}),(0,s.jsxs)("div",{className:"mb-4 flex gap-4 items-end",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"Start Date"}),(0,s.jsx)("input",{type:"date",value:e,onChange:e=>t(e.target.value),className:"mt-1 block w-full p-2 border bg-white text-black"})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"End Date"}),(0,s.jsx)("input",{type:"date",value:a,onChange:e=>i(e.target.value),className:"mt-1 block w-full p-2 border bg-white text-black"})]})]}),(0,s.jsx)("div",{className:"overflow-x-auto min-h-[450px]",children:(0,s.jsxs)("table",{className:"table table-xs",children:[(0,s.jsx)("thead",{children:(0,s.jsxs)("tr",{className:"bg-gray-200",children:[(0,s.jsx)("th",{className:"px-4 py-2 border-b text-black text-center",children:(0,s.jsx)("input",{type:"checkbox",checked:u,onChange:()=>{u?b([]):b(y.map(e=>e.employeeId)),g(!u)}})}),(0,s.jsx)("th",{className:"px-4 py-2 border-b text-black text-center",children:"Name"}),(0,s.jsx)("th",{className:"px-4 py-2 border-b text-black text-center",children:"Employee ID"}),(0,s.jsx)("th",{className:"px-4 py-2 border-b text-black text-center",children:"Email"}),(0,s.jsx)("th",{className:"px-4 py-2 border-b text-black text-center",children:"Position"}),(0,s.jsx)("th",{className:"px-4 py-2 border-b text-black text-center",children:"Department"})]})}),(0,s.jsx)("tbody",{children:F.length>0?F.map(e=>(0,s.jsxs)("tr",{children:[(0,s.jsx)("td",{className:"px-4 py-2 border-b text-black text-center",children:(0,s.jsx)("input",{type:"checkbox",checked:p.includes(e.employeeId),onChange:()=>S(e.employeeId)})}),(0,s.jsx)("td",{className:"px-4 py-2 border-b text-black text-center",children:e.name}),(0,s.jsx)("td",{className:"px-4 py-2 border-b text-black text-center",children:e.employeeId}),(0,s.jsx)("td",{className:"px-4 py-2 border-b text-black text-center",children:e.email}),(0,s.jsx)("td",{className:"px-4 py-2 border-b text-black text-center",children:e.position}),(0,s.jsx)("td",{className:"px-4 py-2 border-b text-black text-center",children:e.department})]},e.id)):(0,s.jsx)("tr",{children:(0,s.jsx)("td",{colSpan:"7",className:"text-center p-4 text-gray-500",children:"No employees found."})})})]})}),(0,s.jsxs)("div",{className:" text-center",children:[(0,s.jsx)("button",{onClick:I,className:"bg-green-500 text-white px-6 py-3 rounded-lg font-semibold",children:"Generate Reports"}),(0,s.jsxs)("div",{className:"flex justify-between items-center mt-3",children:[(0,s.jsx)("button",{onClick:()=>{h>1&&m(h-1)},disabled:1===h,className:"bg-gray-500 text-white px-4 py-2 rounded disabled:opacity-50",children:"Previous"}),(0,s.jsxs)("span",{children:["Page ",h," of ",v]}),(0,s.jsx)("button",{onClick:()=>{h<v&&m(h+1)},disabled:h===v,className:"bg-gray-500 text-white px-4 py-2 rounded disabled:opacity-50",children:"Next"})]})]})]})})})]})}},93137:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>m});var s=a(95155),l=a(48173),n=a.n(l),c=a(12115),r=a(76046),o=a(689),i=a(87936),d=a(21354),x=a(13261),h=a(5565);let m=()=>{let[e,t]=(0,c.useState)(!1),[a,l]=(0,c.useState)(!1),[m,p]=(0,c.useState)(!1),[b,u]=(0,c.useState)(null),[g,y]=(0,c.useState)(!1),j=(0,r.useRouter)(),N=(0,r.usePathname)(),f={"/employerDashboard":"Dashboard","/employeeMonitoring":"Employee Monitoring","/approvalRequest":"Approval Request","/manageEmployee":"Manage Employee","/employerReports":"Reports","/screenCaptureMonitoring":"Screen Capture"},w=f[N]||"Dashboard";return(0,c.useEffect)(()=>{let e=localStorage.getItem("user");e&&u(JSON.parse(e))},[]),(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)("nav",{className:"bg-white shadow-md text-gray-600 relative z-50",children:[(0,s.jsxs)("div",{className:"container mx-auto px-4 py-3 flex justify-between items-center",children:[(0,s.jsxs)("div",{className:"flex items-center",children:[(0,s.jsx)("button",{className:"md:hidden text-red mr-3",onClick:()=>t(!e),children:e?(0,s.jsx)(o.A,{className:"w-6 h-6"}):(0,s.jsx)(i.A,{className:"w-6 h-6"})}),(0,s.jsx)("div",{className:"hidden md:flex space-x-6",children:Object.keys(f).map(e=>(0,s.jsx)(n(),{href:e,className:"".concat(N===e?"bg-[#FFFFFF] text-gray-700 font-semibold text-lg":"text-gray-400 text-base"," hover:bg-[#FFFFFF] hover:text-black px-2 py-2 rounded"),children:f[e]},e))})]}),(0,s.jsxs)("div",{className:"relative",children:[(0,s.jsxs)("button",{className:"flex items-center space-x-2 text-black",onClick:()=>l(!a),children:[(0,s.jsx)("div",{className:"avatar avatar-online",children:(0,s.jsx)("div",{className:"w-9 h-9 rounded-full ring ",children:(0,s.jsx)(h.default,{src:"/img/user-icon.png",alt:"User Icon",width:60,height:60,className:"w-14 h-14 mr-4"})})}),(0,s.jsx)("span",{className:"text-gray-600",children:b?b.name:"Loading..."})]}),a&&(0,s.jsxs)("div",{className:"absolute right-0 mt-2 w-48 bg-white text-black rounded-lg shadow-lg",children:[(0,s.jsxs)("div",{className:"p-2 border-b",children:[(0,s.jsx)("p",{className:"text-sm font-semibold",children:b?b.name:"Unknown"}),(0,s.jsx)("p",{className:"text-xs text-gray-500",children:b?b.email:"No Email"})]}),(0,s.jsxs)("button",{onClick:()=>{l(!1),p(!0),setTimeout(()=>{p(!1),localStorage.removeItem("user"),localStorage.removeItem("authToken"),j.push("/")},2e3)},className:"w-full text-left px-4 py-2 text-red-600 hover:bg-gray-100 flex items-center",children:[(0,s.jsx)(d.A,{className:"w-5 h-5 mr-2"}),"Logout"]})]})]})]}),(0,s.jsx)("div",{className:"".concat(e?"block":"hidden"," md:hidden bg-[#135D66] py-2"),children:Object.keys(f).map(e=>(0,s.jsx)(n(),{href:e,className:"".concat(N===e?"bg-[#0F4A55]":""," block px-4 py-2 text-white hover:bg-[#0F4A55]"),children:f[e]},e))}),m&&(0,s.jsxs)("div",{className:"absolute top-4 right-4 bg-green-600 text-white p-3 rounded-lg shadow-lg flex items-center",children:[(0,s.jsx)(x.A,{className:"w-5 h-5 mr-2"}),"Logging out..."]})]}),(0,s.jsx)("div",{className:"container mx-auto mt-6 p-6 bg-gray-700 shadow-xl flex justify-between items-center",children:(0,s.jsx)("h1",{className:"text-xl font-semibold text-white",children:w})})]})}}},e=>{var t=t=>e(e.s=t);e.O(0,[3930,8376,5927,5202,8441,1517,7358],()=>t(26838)),_N_E=e.O()}]);
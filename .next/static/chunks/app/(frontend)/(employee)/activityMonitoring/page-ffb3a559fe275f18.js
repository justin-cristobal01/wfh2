(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[9936],{99372:(e,t,l)=>{Promise.resolve().then(l.bind(l,36669))},36669:(e,t,l)=>{"use strict";l.r(t),l.d(t,{default:()=>d});var r=l(95155),s=l(58640),a=l(12115),o=l(76046),n=l(76472),i=l(35781),c=l(9861);i.t1.register(i.PP,i.kc,i.FN,i.No,i.hE,i.m_,i.s$,c.A);let d=()=>{let e=(0,o.useRouter)(),[t,l]=(0,a.useState)(!0),[i,c]=(0,a.useState)([]),[d,u]=(0,a.useState)([]),m=localStorage.getItem("user"),g=m?JSON.parse(m):null,h=null==g?void 0:g.employeeId,[p,x]=(0,a.useState)(null),f=async e=>{try{let t=await fetch("/employerAPI/employee");if(!t.ok)throw Error("Failed to fetch employees");let l=(await t.json()).find(t=>t.employeeId===e);if(!l)return console.log("Employee not found"),null;return{timeIn:l.scheduleTimeIn||"07:00",timeOut:l.scheduleTimeOut||"17:00"}}catch(e){return console.error("Error fetching employee schedule:",e),null}},y=e=>{let[t,l]=e.split(":").map(Number);return{hour:t,minute:l}};(0,a.useEffect)(()=>{localStorage.getItem("authToken")?l(!1):e.push("/")},[]),(0,a.useEffect)(()=>{h&&(async()=>{x(await f(h))})()},[h]),(0,a.useEffect)(()=>{if(!h)return;console.log(p,"schedule here");let e=new EventSource("/employeeAPI/humanActivityGraph?employeeId=".concat(h));return e.onmessage=e=>{try{let t=JSON.parse(e.data);u(t)}catch(e){console.error("❌ Error parsing activity logs:",e)}},e.onerror=t=>{console.error("❌ SSE connection error:",t),e.close()},()=>{e.close()}},[h]),(0,a.useEffect)(()=>{if(!h)return;let e=new EventSource("/employeeAPI/humanActivityLog?employeeId=".concat(h));return e.onmessage=e=>{try{let t=JSON.parse(e.data);c(t)}catch(e){console.error("❌ Error parsing activity logs:",e)}},e.onerror=t=>{console.error("❌ SSE connection error:",t),e.close()},()=>{e.close()}},[h]);let N=e=>{let t={timeZone:"Asia/Manila",hour12:!1};return new Date(new Date(e).toLocaleString("en-US",t)).toLocaleString("en-US",t)};return(0,r.jsxs)("div",{className:"min-h-screen bg-white",children:[(0,r.jsx)(s.default,{}),(0,r.jsx)("div",{className:"container mx-auto p-2 mt-2",children:(0,r.jsxs)("div",{className:"space-y-6",children:[(0,r.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-1 gap-2",children:(0,r.jsx)("div",{className:"bg-white shadow-xl text-black p-6 rounded-lg",children:(0,r.jsx)("div",{className:"mt-4 p-3 bg-gray-100 rounded-lg h-80",children:(0,r.jsx)(n.N1,{data:(()=>{if(!p)return{labels:[],datasets:[]};let{hour:e,minute:t}=y(p.timeIn),{hour:l,minute:r}=y(p.timeOut),s=[],a=e,o=t;for(;a<l||a===l&&o<=r;)s.push("".concat(a,":").concat(o<10?"0"+o:o)),(o+=5)>=60&&(o=0,a++);let n={total:Array(s.length).fill(0)};return i.forEach(t=>{let r=new Date(t.start),s=new Date(t.end),a=r.getHours(),o=r.getMinutes(),i=s.getHours(),c=s.getMinutes(),d=t.activity;if(e>=e&&e<=l){let t=Math.floor(((a-e)*60+o)/5),l=Math.floor(((i-e)*60+c)/5),r=["Active","Idle","Sleeping"].indexOf(d);for(let e=t;e<=l;e++)n.total[e]=r}}),{labels:s,datasets:[{label:"Activity (Total)",data:n.total,borderColor:"green",backgroundColor:"rgba(0, 128, 0, 0.2)",fill:!1,tension:.1}]}})(),options:{responsive:!0,maintainAspectRatio:!1,plugins:{legend:{display:!1}},scales:{y:{beginAtZero:!0,ticks:{stepSize:1,callback:function(e){return["Active","Idle","Sleeping"][Number(e)]||(e<3?e:"")}}},x:{title:{display:!0,text:"Time (".concat((null==p?void 0:p.timeIn)||"07:00"," AM to ").concat((null==p?void 0:p.timeOut)||"05:00"," PM)")},ticks:{autoSkip:!0,maxRotation:90,minRotation:45}}}}})})})}),(0,r.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-1 gap-2",children:(0,r.jsxs)("div",{className:"bg-white shadow-xl text-black p-6 rounded-lg",children:[(0,r.jsx)("h2",{className:"text-xl font-semibold",children:"HUMAN ACTIVITY RECOGNITION"}),(0,r.jsx)("p",{className:"mt-2 text-sm text-gray-500",children:"Alertness Report & Real-Time Alert Log."}),(0,r.jsxs)("div",{className:"mt-4 p-3 bg-gray-100 rounded-lg h-80 overflow-auto text-sm",children:[(0,r.jsx)("h3",{className:"text-md font-semibold text-gray-700 mb-2",children:"Real-Time Log:"}),(0,r.jsx)("ul",{className:"space-y-2",children:i.length>0?i.map((e,t)=>(0,r.jsxs)("li",{children:[(0,r.jsx)("span",{className:"font-medium",children:e.activity}),(0,r.jsxs)("span",{className:"text-gray-500 text-xs ml-2",children:[N(e.start)," -"," ",e.end?N(e.end):"Ongoing"]})]},t)):(0,r.jsx)("p",{className:"text-gray-500",children:"No logs available."})})]})]})})]})})]})}}},e=>{var t=t=>e(e.s=t);e.O(0,[5056,3690,6251,7087,3660,2674,272,5647,8376,5927,9740,2675,9008,9038,8640,8441,1517,7358],()=>t(99372)),_N_E=e.O()}]);